---
- hosts: localhost
  connection: local
  tasks:

    - name: Importing the variables file
      include_vars: vars/outputs

    - name: Importing the bashion variable
      include_vars: vars/bashion

    - name: Creating Bashion Host
      amazon.aws.ec2_instance:
        key_name: bashion_key  # Ensure this matches the created key name
        region: "{{region}}"  # Ensure the region variable is defined
        instance_type: t2.micro
        image_id: "{{bashion_ami}}"  # Make sure this AMI ID is valid in the specified region
        wait: yes
        wait_timeout: 300
        instance_tags: # Corrected from instance_tag to instance_tags
          Name: "Bashion-proj"
          Owner: Devops Team
        exact_count: 1
        count_tag:
          Name: "Bashion-proj"
          Project: Projans
          Owner: Devops Team
        group_id: "{{ bashionSG_out.group_id }}"  # Ensure this variable is defined
        vpc_subnet_id: "{{ pubsub1_id }}"  # Ensure this variable is defined
      register: bashionHost_out